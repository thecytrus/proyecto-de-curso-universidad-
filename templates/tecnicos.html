<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestión de Usuarios - EcoSmart</title>

  <!-- Materialize CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Estilos personalizados -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
</head>

<body>
  <header>
    <nav class="white">
      <div class="nav-wrapper container">
        <a href="{{ url_for('index') }}" class="brand-logo">
          <img src="{{ url_for('static', filename='images/logo.png') }}"
               alt="EcoSmart Logo"
               style="height: 60px; vertical-align: middle;">
        </a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
        </ul>
      </div>
    </nav>
  </header>

  <main class="container">
    <div class="section">
      <h4 class="center-align">Usuarios Registrados</h4>

      {% with messages = get_flashed_messages(with_categories=True) %}
        {% if messages %}
          <div class="card-panel">
            {% for category, message in messages %}
              <span class="{{ category }}">{{ message }}</span>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <div class="card">
        <div class="card-content">
          <span class="card-title"><i class="material-icons left">people</i>Lista de Usuarios</span>

          <table class="striped responsive-table centered">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Correo</th>
                <th>Tipo</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% if usuarios %}
                {% for usuario in usuarios %}
                <tr id="row-{{ usuario['id'] }}">
                  <td>{{ usuario['id'] }}</td>
                  <td>{{ usuario['nombre'] }}</td>
                  <td>{{ usuario['correo'] }}</td>
                  <td>{{ usuario['tipo_usuario'] }}</td>
                  <td>
                    <a href="{{ url_for('tecnicos_bp.editar_usuario', id=usuario['id']) }}"
                       class="btn-small blue lighten-1 white-text tooltipped"
                       data-tooltip="Editar usuario"
                       style="margin-right: 5px;">
                      <i class="material-icons">edit</i>
                    </a>
                    <a href="{{ url_for('tecnicos_bp.eliminar_usuario', id=usuario['id']) }}"
                       class="btn-small red lighten-1 white-text tooltipped"
                       data-tooltip="Eliminar usuario"
                       onclick="return confirm('¿Estás seguro de eliminar este usuario?');">
                      <i class="material-icons">delete</i>
                    </a>
                  </td>
                </tr>
                {% endfor %}
              {% else %}
                <tr><td colspan="5">No se encontraron usuarios.</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
        <div class="card-action center-align">
          <a href="{{ url_for('index') }}" class="btn green darken-1">
            <i class="material-icons left">arrow_back</i>Volver al inicio
          </a>
        </div>
      </div>
    </div>
  </main>

  <footer class="page-footer green lighten-1">
    <div class="container center">
      © 2025 EcoSmart - Todos los derechos reservados
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const tooltips = document.querySelectorAll('.tooltipped');
      M.Tooltip.init(tooltips);
    });
  </script>
</body>
</html>
